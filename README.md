# Rusty_PresentParsing
Copyright Â© 2019 Chris Gatehouse

Project: Rusty_PresentParsing and Data Analysis

This project is an implementation of a parser for the PresentMon application. It will provide detailed results from the data collected with the PresentMon application

There are some existing parsers for the data that is generated with the PresentMon program but they are either not kept up anymore or don't analyze and present the data in ways that are completley useful to me. This is also meant to be an exercise in learning Rust in depth.

Planned functions: (CLI) X - denotes completed
  1. Parse the CSV file generated by PresentMon
  2. Calculate the following  
    - [x] Avg. FPS  
    - [x] Avg. Frametimes  
    - [x] Median FPS  
    - [x] Median Frametime  
    - [x] 1%/99% Low FPS exact and average  
    - [ ] 3%/97% Low FPS exact and average  
    - [x] Number of Dropped Frames  
    - [x] Frames below threshold values i.e. 30, 60, 144, 240 FPS  
    - [x] Detect number of frametime spikes that would be visible stutter\lag (initially implemented as jitter)

This program will operate on the command line. It will take a file to work on as an argument and generate and display the results on the [x] command line and also [ ] output the results to a log file.  

Stretch functions: (No specific order)
  - Work on multiple datasets in a given directory to combine results i.e. n runs of a game gives one set of results after processing
     - Partially implemented - process all csv files in a given directory and prints results for each
     - Not implemented - aggregate all results into one set of values
  - Parse CSV file generated by other programs that may be used simultaneuosly while gathering data i.e. HWiNFO  
  - Setup and start PresentMon and other programs and sync their data collection  
  - Move from CLI to GUI  
  - Generate new CSV or datafile that is easily consumed by other programs to generate graphs/charts  
  
Information on and PresetMon can be found here: https://github.com/GameTechDev/PresentMon

# Running the parser
To run this parser is simple. It takes an argument as either a single csv file that was generated by PresentMon or a directory that contains multiple csv files generated by PresentMon. I've included one small csv file generated by PresentMon in the data dir of this repo and will use it for the below examples.
  
Single file run with cargo: cargo run ..\data\data_1000.csv  
Single file run with binary: rusty_present_parser.exe ..\data\data_1000.csv  
Output:   
Single file "..\\data\\data_1000.csv" is input  
Jitter before sorting: 0.55 ms  
Total frame time in ms: 5416.615999999999  
Total frame time in s: 5.416615999999999  
Total frames rendered: 1000  
Total dropped frames: 0  
Median FPS:     189.36  
1% Low FPS:     118.76  
0.1% Low FPS:   96.75  
Avg. FPS:       184.62  
Avg. 1% FPS:    114.24  
Avg. 0.1% FPS:  96.75  
Below 60 FPS:   0.00%  
Below 144 FPS:  5.60%  
Below 165 FPS:  10.20%  
Below 240 FPS:  100.00%  

If you want to process a directoy then the following command is for you.  
Directory run with cargo: cargo run ..\data\  
Directory run with binary:  rusty_present_parser.exe ..\..\..\data\  
Processing directory files in "..\\data\\"  
    
CSV FILES FOUND: 2  
    
WORKING FILE: "..\\data\\data_1000.csv"  
Jitter before sorting: 0.55 ms  
Total frame time in ms: 5416.615999999999  
Total frame time in s: 5.416615999999999  
Total frames rendered: 1000  
Total dropped frames: 0  
Median FPS:     189.36  
1% Low FPS:     118.76  
0.1% Low FPS:   96.75  
Avg. FPS:       184.62  
Avg. 1% FPS:    114.24  
Avg. 0.1% FPS:  96.75  
Below 60 FPS:   0.00%  
Below 144 FPS:  5.60%  
Below 165 FPS:  10.20%  
Below 240 FPS:  100.00%  
  
  
WORKING FILE: "..\\data\\PresentMon_dataset.csv"  
Jitter before sorting: 1.10 ms  
Total frame time in ms: 89543.58300000013  
Total frame time in s: 89.54358300000013  
Total frames rendered: 10512  
Total dropped frames: 0  
Median FPS:     118.69  
1% Low FPS:     65.05  
0.1% Low FPS:   54.19  
Avg. FPS:       117.40  
Avg. 1% FPS:    59.56  
Avg. 0.1% FPS:  53.01  
Below 60 FPS:   0.48%  
Below 144 FPS:  66.96%  
Below 165 FPS:  81.54%  
Below 240 FPS:  100.00%  

# Known Issues / Limitations  
  - Errors in the PresentMon data set may cause a crash if I have not seen the specific condition yet, known errors that are not critical will be noted in the results.  
  - If frame syncs of some type were enabled during the PresentMon run results may not be what you expected i.e. values seem to hit some framerate ceiling (this will be detected later)  
  - The program will process all csv files in a directory, if csv files exist that are not in the correct format the program will not run correctly  

# Tests
As of right now the source contains 6 tests that will check for correct results from the methods used to calculate values. You can run the tests by using 'cargo test'. More tests will be added as needed.  
Sample test run: cargo test  
running 6 tests  
test tests::below_threshold_count ... ok  
test tests::jitter_correct ... ok  
test tests::median_even_set ... ok  
test tests::median_odd_set ... ok  
test tests::correct_average_ranged_fps_one_percent_low ... ok  
test tests::correct_ranged_fps_zero_point_one_percent_low ... ok  
  
test result: ok. 6 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out  
  

# License

This program is licenced under the "MIT License". Please see the file 'LICENSE' in this distribution for license terms.

